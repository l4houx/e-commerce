{% extends 'base.html.twig' %}

{% set pagetitle = 'Manage users '|trans ~ (rows.getTotalItemCount) %}
{% block title pagetitle %}

{% block breadcrumb %}
	{% set breadcrumb = [{ "dashboard_main": ('Dashboard'|trans), "current":(pagetitle) }] %}
	{% include "global/breadcrumb.html.twig" with breadcrumb %}
{% endblock %}

{% block body %}
    <section class="pt-0">
        <div class="container">
            <div class="row g-3 align-items-center mb-5">
                <div class="col-xl-6">
                    <form class="rounded position-relative">
                        <input class="form-control pe-5" type="search" name="keyword" value="{{ app.request.get('keyword') }}" placeholder="{{ 'Search...'|trans }}" aria-label="Search">
                        <button class="btn border-0 px-3 py-0 position-absolute top-50 end-0 translate-middle-y" type="submit">
                            <i class="fas fa-search fs-6"></i>
                        </button>
                    </form>
                </div>
                <div class="col-sm-6 col-xl-3 ms-auto">
                    <form>
                        <select class="form-select js-choice" aria-label=".form-select-sm" autocomplete="off">
                            <option>{{ "Sort by"|trans }}</option>
                            <option value="">{{ knp_pagination_sortable(rows, "Registration date"|trans ~ ' (' ~ "desc"|trans ~ ')', "u.createdAt", {"direction": "desc", "criteria": "u.createdAt"}) }}</option>
                            <option value="">{{ knp_pagination_sortable(rows, "Registration date"|trans ~ ' (' ~ "asc"|trans ~ ')', "u.createdAt", {"direction": "asc", "criteria": "u.createdAt"}) }}</option>
                            <option value="">{{ knp_pagination_sortable(rows, "Last login"|trans ~ ' (' ~ "desc"|trans ~ ')', "u.lastLogin", {"direction": "desc", "criteria": "u.lastLogin"}) }}</option>
                            <option value="">{{ knp_pagination_sortable(rows, "Last login"|trans ~ ' (' ~ "asc"|trans ~ ')', "u.lastLogin", {"direction": "asc", "criteria": "u.lastLogin"}) }}</option>
                        </select>
                    </form>
                </div>
                <div class="col-sm-6 col-xl-3">
                    <a href="#search-filters" class="btn btn-primary mb-0" data-bs-toggle="collapse" title="{{ "Toggle display the search filters"|trans }}" aria-expanded="false" aria-controls="search-filters">
                        <i class="fab fa-searchengin fa-lg"></i>
                    </a>
                </div>
                <div id="search-filters" class="col-md-12 col-lg-12 text-center mb-3 mb-lg-0 collapse">
                    <form class="mt-3">
                        <div class="row">
                            <div class="col-12 col-md-4 text-start mb-4">
                                <label class="form-label" for="role">{{ "Role"|trans }}</label>
                                <select class="form-select select2" id="role" name="role">
                                    <option value="all">{{ "All"|trans }}</option>
                                    <option value="user">{{ "User"|trans }}</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-4 text-start mb-4">
                                <label class="form-label" for="username">{{ "Username"|trans }}</label>
                                <input type="text" class="form-control mr-sm-2 mb-2 mb-sm-0" id="username" name="username" value="{{ app.request.get('username') }}">
                            </div>
                            <div class="col-12 col-md-4 text-start mb-4">
                                <label class="form-label" for="email">{{ "Email"|trans }}</label>
                                <input type="text" class="form-control mr-sm-2 mb-2 mb-sm-0" id="email" name="email" value="{{ app.request.get('email') }}">
                            </div>
                            <div class="col-12 col-md-4 text-start mb-4">
                                <label class="form-label" for="firstname">{{ "First name"|trans }}</label>
                                <input type="text" class="form-control mr-sm-2 mb-2 mb-sm-0" id="firstname" name="firstname" value="{{ app.request.get('firstname') }}">
                            </div>
                            <div class="col-12 col-md-4 text-start mb-4">
                                <label class="form-label" for="lastname">{{ "Last name"|trans }}</label>
                                <input type="text" class="form-control mr-sm-2 mb-2 mb-sm-0" id="lastname" name="lastname" value="{{ app.request.get('lastname') }}">
                            </div>
                            <div class="col-12 col-md-4 text-start mb-4">
                                <div class="mb-3">
                                    <label class="form-label">{{ "Verified"|trans }}</label>
                                    <br>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="isVerified" id="isverified-filter-all" value="all">
                                        <label class="form-check-label" for="isverified-filter-all">{{ "All"|trans }}</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="isVerified" id="isverified-filter-yes" value="1">
                                        <label class="form-check-label" for="isverified-filter-yes">{{ "IsVerified only"|trans }}</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="isVerified" id="isverified-filter-no" value="0">
                                        <label class="form-check-label" for="isverified-filter-no">{{ "Disabled only"|trans }}</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-4 text-start mb-4">
                                <button type="submit" class="btn btn-primary" data-bs-toggle="tooltip" title="{{ "Search"|trans }}">
                                    <i class="fas fa-search"></i>
                                </button>
                                <button type="reset" class="btn btn-primary" data-bs-toggle="tooltip" title="{{ "Reset"|trans }}">
                                    <i class="fas fa-search-minus"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="card bg-transparent">
                        <div class="card-header bg-transparent border-bottom d-flex justify-content-between align-items-center p-0 pb-3">
                            <h6 class="card-title mb-0">
                                {{ "%resultsCount% result(s) found"|trans({'%resultsCount%': rows.getTotalItemCount}) }}
                            </h6>
                            <div>
                                {% if is_granted('ROLE_VERIFIED') %}
                                    <a href="{{ path('dashboard_admin_user_new') }}" class="btn btn-sm btn-primary me-2">
                                        {{ 'Create'|trans }}
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                        {% if rows.getTotalItemCount > 0 %}
                            {% include "dashboard/admin/user/manage-users-table.html.twig" with {rows: rows} %}
                        {% else %}
                            <div class="card-footer bg-transparent p-0">
                                {% include "global/message.html.twig" with { type: "dark", message: ('No users found'|trans), icon: "fas fa-exclamation", class: "my-2" } %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function () {
            if (getURLParameter('role')) {
                $('#role').val(getURLParameter('role')).change();
            }

            if (getURLParameter('isVerified')) {
                $('input[type="radio"][name="isVerified"][value="' + getURLParameter('isVerified') + '"]').attr("checked", "checked");
            }
        });
    </script>
{% endblock %}
